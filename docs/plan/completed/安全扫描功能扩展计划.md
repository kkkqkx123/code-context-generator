# å®‰å…¨æ‰«æåŠŸèƒ½æ‰©å±•è®¡åˆ’

## åŠŸèƒ½æ¦‚è¿°

åŸºäºrepomixçš„å®‰å…¨æ£€æŸ¥åŠŸèƒ½ï¼Œä¸ºé¡¹ç›®æ·»åŠ ä»£ç å®‰å…¨æ‰«æèƒ½åŠ›ï¼Œæ£€æµ‹æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²å’Œä»£ç è´¨é‡é—®é¢˜ã€‚

## å½“å‰çŠ¶æ€åˆ†æ

### ç°æœ‰åŠŸèƒ½
- âŒ æ— å®‰å…¨æ‰«æåŠŸèƒ½
- âŒ æ— æ³•æ£€æµ‹æ•æ„Ÿä¿¡æ¯
- âŒ ç¼ºå°‘ä»£ç è´¨é‡æ£€æŸ¥

### ä¸repomixå¯¹æ¯”
- âŒ ç¼ºå°‘å®‰å…¨æ£€æŸ¥æ§åˆ¶
- âŒ ç¼ºå°‘æ•æ„Ÿä¿¡æ¯æ£€æµ‹
- âŒ ç¼ºå°‘å®‰å…¨æŠ¥å‘Šç”Ÿæˆ

## æ‰©å±•ç›®æ ‡

### æ ¸å¿ƒåŠŸèƒ½
1. **æ•æ„Ÿä¿¡æ¯æ£€æµ‹** - APIå¯†é’¥ã€å¯†ç ã€ä»¤ç‰Œç­‰
2. **å®‰å…¨æ¼æ´æ‰«æ** - å¸¸è§ä»£ç å®‰å…¨æ¼æ´
3. **ä»£ç è´¨é‡æ£€æŸ¥** - æœ€ä½³å®è·µå’Œè§„èŒƒæ£€æŸ¥
4. **å®‰å…¨æŠ¥å‘Šç”Ÿæˆ** - è¯¦ç»†çš„å®‰å…¨è¯„ä¼°æŠ¥å‘Š

### å®‰å…¨æ£€æµ‹ç±»å‹
- **ç¡¬ç¼–ç å‡­è¯** - APIå¯†é’¥ã€å¯†ç ã€ä»¤ç‰Œ
- **æ•æ„Ÿé…ç½®** - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€å¯†é’¥æ–‡ä»¶
- **å®‰å…¨æ¼æ´** - SQLæ³¨å…¥ã€XSSã€è·¯å¾„éå†
- **ä»£ç è´¨é‡** - æœªä½¿ç”¨çš„å˜é‡ã€é”™è¯¯å¤„ç†

## æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 1. å®‰å…¨æ‰«æå¼•æ“

#### æ ¸å¿ƒæ¶æ„
```go
type SecurityScanner struct {
    detectors []SecurityDetector
    config    SecurityConfig
    reporter  SecurityReporter
}

type SecurityDetector interface {
    Detect(filePath string, content string) []SecurityIssue
    GetName() string
    GetSeverity() SeverityLevel
}

type SeverityLevel int

const (
    SeverityLow SeverityLevel = iota
    SeverityMedium
    SeverityHigh
    SeverityCritical
)
```

#### æ£€æµ‹å™¨ç±»å‹
- **æ­£åˆ™æ£€æµ‹å™¨** - åŸºäºæ¨¡å¼åŒ¹é…çš„æ£€æµ‹
- **è¯­æ³•æ£€æµ‹å™¨** - åŸºäºè¯­æ³•åˆ†æçš„æ£€æµ‹
- **è¯­ä¹‰æ£€æµ‹å™¨** - åŸºäºä»£ç ç†è§£çš„æ£€æµ‹

### 2. æ£€æµ‹è§„åˆ™åº“

#### ç¡¬ç¼–ç å‡­è¯æ£€æµ‹
```go
// APIå¯†é’¥æ¨¡å¼
var apiKeyPatterns = []string{
    `(?i)(api[_-]?key)[\s]*[=:][\s]*['\"]([a-zA-Z0-9]{20,50})['\"]`,
    `(?i)(secret[_-]?key)[\s]*[=:][\s]*['\"]([a-zA-Z0-9]{20,50})['\"]`,
    `(?i)(access[_-]?token)[\s]*[=:][\s]*['\"]([a-zA-Z0-9]{20,50})['\"]`,
}

// å¯†ç æ¨¡å¼
var passwordPatterns = []string{
    `(?i)(password|pwd)[\s]*[=:][\s]*['\"]([^'\"]{6,50})['\"]`,
    `(?i)(db[_-]?password)[\s]*[=:][\s]*['\"]([^'\"]{6,50})['\"]`,
}
```

#### å®‰å…¨æ¼æ´æ£€æµ‹
```go
// SQLæ³¨å…¥æ£€æµ‹
func detectSQLInjection(content string) []SecurityIssue {
    var issues []SecurityIssue
    
    // æ£€æµ‹å­—ç¬¦ä¸²æ‹¼æ¥çš„SQLæŸ¥è¯¢
    patterns := []string{
        `(?i)SELECT\s.*\+.*FROM`,
        `(?i)INSERT\s.*\+.*INTO`,
        `(?i)UPDATE\s.*\+.*SET`,
        `(?i)DELETE\s.*\+.*FROM`,
    }
    
    for _, pattern := range patterns {
        if regexp.MustCompile(pattern).MatchString(content) {
            issues = append(issues, SecurityIssue{
                Type:     "SQL Injection",
                Severity: SeverityHigh,
                Message:  "Potential SQL injection vulnerability detected",
                Location: findLineNumber(content, pattern),
            })
        }
    }
    
    return issues
}
```

### 3. é…ç½®ç³»ç»Ÿ

#### å®‰å…¨é…ç½®ç»“æ„
```go
type SecurityConfig struct {
    Enabled          bool              `json:"enabled"`
    FailOnCritical   bool              `json:"fail_on_critical"`
    ScanLevel        ScanLevel         `json:"scan_level"`
    
    Detectors        DetectorConfig    `json:"detectors"`
    Exclusions       ExclusionConfig   `json:"exclusions"`
    Reporting        ReportingConfig   `json:"reporting"`
}

type ScanLevel int

const (
    ScanLevelBasic ScanLevel = iota    // åŸºç¡€æ‰«æ
    ScanLevelStandard                  // æ ‡å‡†æ‰«æ
    ScanLevelComprehensive             // å…¨é¢æ‰«æ
)
```

#### æ£€æµ‹å™¨é…ç½®
```yaml
security:
  enabled: false
  fail_on_critical: true
  scan_level: "standard"  # basic, standard, comprehensive
  
  detectors:
    # æ•æ„Ÿä¿¡æ¯æ£€æµ‹
    hardcoded_credentials:
      enabled: true
      severity_threshold: "medium"
      patterns:
        - "api_key"
        - "secret_key"
        - "access_token"
        - "password"
    
    # å®‰å…¨æ¼æ´æ£€æµ‹
    sql_injection:
      enabled: true
      severity_threshold: "high"
    
    xss_vulnerabilities:
      enabled: true
      severity_threshold: "high"
    
    path_traversal:
      enabled: true
      severity_threshold: "medium"
    
    # ä»£ç è´¨é‡æ£€æµ‹
    unused_variables:
      enabled: false
      severity_threshold: "low"
    
    error_handling:
      enabled: true
      severity_threshold: "medium"
  
  # æ’é™¤é…ç½®
  exclusions:
    files:
      - "**/test/**"
      - "**/vendor/**"
      - "**/node_modules/**"
    
    patterns:
      - "test.*"
      - "mock.*"
    
    # ç‰¹å®šæ’é™¤è§„åˆ™
    rules:
      - pattern: "API_KEY_TEST"
        reason: "æµ‹è¯•ç¯å¢ƒå˜é‡"
      - pattern: "password.*test"
        reason: "æµ‹è¯•å¯†ç "
  
  # æŠ¥å‘Šé…ç½®
  reporting:
    format: "text"  # text, json, html, sarif
    output_file: "security_report.txt"
    include_details: true
    show_statistics: true
```

### 4. æŠ¥å‘Šç³»ç»Ÿ

#### å®‰å…¨æŠ¥å‘Šç»“æ„
```go
type SecurityReport struct {
    ScanID        string          `json:"scan_id"`
    Timestamp     time.Time       `json:"timestamp"`
    ScanDuration  time.Duration   `json:"scan_duration"`
    
    Summary       ScanSummary     `json:"summary"`
    Issues        []SecurityIssue `json:"issues"`
    Statistics    ScanStatistics  `json:"statistics"`
    
    Config        SecurityConfig  `json:"config"`
}

type ScanSummary struct {
    TotalFiles        int `json:"total_files"`
    ScannedFiles      int `json:"scanned_files"`
    IssuesFound       int `json:"issues_found"`
    CriticalIssues   int `json:"critical_issues"`
    HighIssues       int `json:"high_issues"`
    MediumIssues     int `json:"medium_issues"`
    LowIssues        int `json:"low_issues"`
}
```

## å®æ–½æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ£€æµ‹ï¼ˆ3å‘¨ï¼‰
1. **æ ¸å¿ƒæ£€æµ‹å™¨å¼€å‘**
   - ç¡¬ç¼–ç å‡­è¯æ£€æµ‹
   - åŸºç¡€å®‰å…¨æ¼æ´æ£€æµ‹
   - é…ç½®ç³»ç»Ÿé›†æˆ

2. **æŠ¥å‘Šç³»ç»Ÿå®ç°**
   - æ–‡æœ¬æ ¼å¼æŠ¥å‘Š
   - åŸºç¡€ç»Ÿè®¡åŠŸèƒ½
   - å‘½ä»¤è¡Œé›†æˆ

### ç¬¬äºŒé˜¶æ®µï¼šé«˜çº§æ£€æµ‹ï¼ˆ2å‘¨ï¼‰
3. **é«˜çº§æ£€æµ‹å™¨**
   - è¯­æ³•åˆ†ææ£€æµ‹
   - ä»£ç è´¨é‡æ£€æŸ¥
   - å¤šè¯­è¨€æ”¯æŒ

4. **æŠ¥å‘Šæ ¼å¼æ‰©å±•**
   - JSONæ ¼å¼æŠ¥å‘Š
   - HTMLå¯è§†åŒ–æŠ¥å‘Š
   - SARIFæ ¼å¼æ”¯æŒ

### ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–é›†æˆï¼ˆ2å‘¨ï¼‰
5. **æ€§èƒ½ä¼˜åŒ–**
   - å¹¶è¡Œæ‰«æä¼˜åŒ–
   - ç¼“å­˜æœºåˆ¶å®ç°
   - å¢é‡æ‰«ææ”¯æŒ

6. **ç”¨æˆ·ä½“éªŒ**
   - äº¤äº’å¼æ‰«æ
   - è‡ªåŠ¨ä¿®å¤å»ºè®®
   - æ–‡æ¡£å®Œå–„

## ä»£ç æ¶æ„

### æ–°å¢åŒ…ç»“æ„
```
internal/security/
â”œâ”€â”€ scanner.go           # å®‰å…¨æ‰«æå™¨ä¸»æ¥å£
â”œâ”€â”€ detectors/          # æ£€æµ‹å™¨å®ç°
â”‚   â”œâ”€â”€ credential_detector.go    # å‡­è¯æ£€æµ‹
â”‚   â”œâ”€â”€ vulnerability_detector.go # æ¼æ´æ£€æµ‹
â”‚   â”œâ”€â”€ quality_detector.go       # è´¨é‡æ£€æµ‹
â”‚   â””â”€â”€ pattern_matcher.go        # æ¨¡å¼åŒ¹é…
â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ security_config.go
â”‚   â””â”€â”€ rule_loader.go
â”œâ”€â”€ reporting/          # æŠ¥å‘Šç³»ç»Ÿ
â”‚   â”œâ”€â”€ reporter.go
â”‚   â”œâ”€â”€ text_reporter.go
â”‚   â”œâ”€â”€ json_reporter.go
â”‚   â”œâ”€â”€ html_reporter.go
â”‚   â””â”€â”€ sarif_reporter.go
â””â”€â”€ types/             # ç±»å‹å®šä¹‰
    â”œâ”€â”€ security_issue.go
    â”œâ”€â”€ scan_result.go
    â””â”€â”€ severity.go

pkg/types/
â”œâ”€â”€ security_config.go  # å®‰å…¨é…ç½®ç±»å‹
â””â”€â”€ security_report.go  # å®‰å…¨æŠ¥å‘Šç±»å‹
```

### ä¾èµ–ç®¡ç†
- **æ ¸å¿ƒä¾èµ–**: æ ‡å‡†åº“æ­£åˆ™è¡¨è¾¾å¼
- **å¯é€‰ä¾èµ–**: è¯­æ³•åˆ†æåº“ï¼ˆé«˜çº§æ£€æµ‹ï¼‰
- **æŠ¥å‘Šæ ¼å¼**: æ¨¡æ¿å¼•æ“ï¼ˆHTMLæŠ¥å‘Šï¼‰

## å‘½ä»¤è¡Œå‚æ•°

### æ–°å¢å‚æ•°
```bash
# å®‰å…¨æ‰«æåŠŸèƒ½
--security-scan              # å¯ç”¨å®‰å…¨æ‰«æ
--no-security-scan          # ç¦ç”¨å®‰å…¨æ‰«æï¼ˆè¦†ç›–é…ç½®ï¼‰
--fail-on-critical          # å‘ç°ä¸¥é‡é—®é¢˜æ—¶å¤±è´¥
--scan-level <level>       # æ‰«æçº§åˆ«

# æ£€æµ‹å™¨æ§åˆ¶
--enable-detector <name>    # å¯ç”¨ç‰¹å®šæ£€æµ‹å™¨
--disable-detector <name>   # ç¦ç”¨ç‰¹å®šæ£€æµ‹å™¨
--severity-threshold <level> # ä¸¥é‡æ€§é˜ˆå€¼

# æŠ¥å‘Šé€‰é¡¹
--security-report <file>    # ç”Ÿæˆå®‰å…¨æŠ¥å‘Š
--report-format <format>    # æŠ¥å‘Šæ ¼å¼
--include-details          # åŒ…å«è¯¦ç»†ä¿¡æ¯

# æ’é™¤é€‰é¡¹
--exclude-files <pattern>   # æ’é™¤æ–‡ä»¶æ¨¡å¼
--exclude-patterns <regex>  # æ’é™¤å†…å®¹æ¨¡å¼
```

## è¾“å‡ºé›†æˆ

### æ§åˆ¶å°è¾“å‡º
```bash
Security Scan Results:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š Scan Summary:
   Files Scanned: 156
   Issues Found: 12 (1 Critical, 3 High, 5 Medium, 3 Low)
   Scan Duration: 2.3s

ğŸ”´ Critical Issues (1):
   â€¢ config/database.go:45 - Hardcoded database password detected

ğŸŸ¡ High Issues (3):
   â€¢ src/api/user.go:23 - Potential SQL injection vulnerability
   â€¢ src/utils/crypto.go:67 - Weak encryption algorithm used
   â€¢ config/app.go:89 - API key exposed in configuration

âœ… Recommendations:
   â€¢ Move sensitive data to environment variables
   â€¢ Use parameterized queries for database operations
   â€¢ Implement proper error handling
```

### æŠ¥å‘Šæ–‡ä»¶ç¤ºä¾‹
```json
{
  "scan_id": "scan_20240115_143022",
  "timestamp": "2024-01-15T14:30:22Z",
  "scan_duration": "2.3s",
  "summary": {
    "total_files": 156,
    "scanned_files": 156,
    "issues_found": 12,
    "critical_issues": 1,
    "high_issues": 3,
    "medium_issues": 5,
    "low_issues": 3
  },
  "issues": [
    {
      "type": "Hardcoded Credential",
      "severity": "critical",
      "message": "Hardcoded database password detected",
      "file": "config/database.go",
      "line": 45,
      "snippet": "password: \"mysecretpassword123\"",
      "recommendation": "Use environment variables for sensitive data"
    }
  ]
}
```

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- æ£€æµ‹å™¨é€»è¾‘æµ‹è¯•
- æ¨¡å¼åŒ¹é…å‡†ç¡®æ€§æµ‹è¯•
- è¾¹ç•Œæ¡ä»¶å¤„ç†æµ‹è¯•

### é›†æˆæµ‹è¯•
- çœŸå®ä»£ç åº“æ‰«ææµ‹è¯•
- å¤šæ–‡ä»¶ç±»å‹å…¼å®¹æ€§æµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•

### å®‰å…¨æµ‹è¯•
- è¯¯æŠ¥ç‡æµ‹è¯•
- æ¼æŠ¥ç‡æµ‹è¯•
- æ£€æµ‹è¦†ç›–ç‡æµ‹è¯•

## æ€§èƒ½è€ƒè™‘

### ä¼˜åŒ–ç­–ç•¥
- **å¹¶è¡Œæ‰«æ**: å¤šæ–‡ä»¶å¹¶è¡Œæ£€æµ‹
- **ç¼“å­˜æœºåˆ¶**: æ£€æµ‹ç»“æœç¼“å­˜
- **å¢é‡æ‰«æ**: åªæ‰«æå˜æ›´æ–‡ä»¶
- **èµ„æºé™åˆ¶**: å†…å­˜å’ŒCPUä½¿ç”¨æ§åˆ¶

### æ€§èƒ½æŒ‡æ ‡
- æ‰«æé€Ÿåº¦: < 100ms/æ–‡ä»¶
- å†…å­˜ä½¿ç”¨: < 100MB
- å¹¶å‘å¤„ç†: æ”¯æŒ10+æ–‡ä»¶å¹¶è¡Œ

## é£é™©è¯„ä¼°

### æŠ€æœ¯é£é™©
- è¯¯æŠ¥ç‡æ§åˆ¶
- æ€§èƒ½å½±å“è¯„ä¼°
- å¤šè¯­è¨€æ”¯æŒå¤æ‚æ€§

### ç¼“è§£æªæ–½
- å¯é…ç½®çš„æ£€æµ‹è§„åˆ™
- æ¸è¿›å¼åŠŸèƒ½å¯ç”¨
- è¯¦ç»†çš„æ’é™¤æœºåˆ¶

## æˆåŠŸæŒ‡æ ‡

### åŠŸèƒ½æŒ‡æ ‡
- æ”¯æŒ10+æ£€æµ‹ç±»å‹
- è¯¯æŠ¥ç‡ < 5%
- æ‰«æé€Ÿåº¦å¯æ¥å—

### è´¨é‡æŒ‡æ ‡
- æ£€æµ‹å‡†ç¡®æ€§ > 90%
- æŠ¥å‘Šå®Œæ•´æ€§ > 95%
- ç”¨æˆ·ä½“éªŒè‰¯å¥½

## åç»­æ‰©å±•

### çŸ­æœŸæ‰©å±•
- æ›´å¤šç¼–ç¨‹è¯­è¨€æ”¯æŒ
- è‡ªå®šä¹‰æ£€æµ‹è§„åˆ™
- IDEæ’ä»¶é›†æˆ

### é•¿æœŸæ‰©å±•
- AIé©±åŠ¨çš„å®‰å…¨åˆ†æ
- è‡ªåŠ¨ä¿®å¤å»ºè®®
- æŒç»­å®‰å…¨ç›‘æ§