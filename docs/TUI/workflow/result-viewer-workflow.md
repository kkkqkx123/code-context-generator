# 结果查看器工作流

## 概述
结果查看器负责显示文件扫描的结果，提供多标签页视图展示不同类型的信息。

## 核心功能

### 多标签页展示
- **概览标签页**: 显示扫描结果的基本统计信息
- **文件标签页**: 显示扫描到的文件列表
- **目录标签页**: 显示扫描到的目录列表

### 信息展示
- 根路径信息
- 文件数量统计
- 目录数量统计
- 总大小显示
- 扫描时间显示

### 交互功能
- Tab键切换标签页
- 上下键滚动内容
- b键返回主界面
- s键保存结果
- Esc键返回主界面

## 工作流程

### 1. 初始化阶段
```
NewResultViewerModel() -> 初始化currentTab为0 -> 等待结果数据
```

### 2. 结果接收流程
```
接收ResultMsg -> 设置result数据 -> 切换到StateResult状态 -> 触发视图更新
```

### 3. 标签页切换流程
```
Tab键按下 -> currentTab递增 -> 模运算确保范围 -> 重新渲染对应内容
```

### 4. 内容渲染流程
```
根据currentTab -> 调用对应render方法 -> 生成字符串内容 -> 显示在视图中
```

## 状态管理

### 内部状态
- `result`: 扫描结果数据
- `scrollOffset`: 滚动偏移量
- `width/height`: 视图尺寸
- `currentTab`: 当前标签页索引

### 标签页定义
```go
tabs := []string{"概览", "文件", "目录"}
```

## 内容渲染

### 概览页面 (renderOverview)
- 根路径: `result.RootPath`
- 文件数量: `result.FileCount`
- 目录数量: `result.FolderCount`
- 总大小: `formatFileSize(result.TotalSize)`
- 扫描时间: `result.ScanDuration`

### 文件页面 (renderFiles)
- 根据scrollOffset计算显示范围
- 显示文件图标和名称
- 显示文件大小
- 支持滚动浏览

### 目录页面 (renderDirectories)
- 根据scrollOffset计算显示范围
- 显示文件夹图标和名称
- 支持滚动浏览

## 已知问题分析

### Tab切换标签未成功
**问题表现：**
- Tab键按下后标签页没有切换
- 当前标签页索引没有更新
- 视图内容没有重新渲染

**可能原因：**
1. 键盘事件处理逻辑错误
2. currentTab更新逻辑有问题
3. 模运算导致索引异常
4. 视图更新机制失效

**代码分析：**
```go
case "tab":
    m.currentTab = (m.currentTab + 1) % 3 // 假设有3个标签页
```

**修复建议：**
1. 检查键盘事件是否正确捕获
2. 验证模运算逻辑是否正确
3. 确保视图在状态变化后重新渲染
4. 添加调试日志跟踪状态变化

### 滚动功能异常
**可能问题：**
- scrollOffset计算错误
- 显示范围判断逻辑有问题
- 边界条件处理不当

## 键盘映射

| 按键 | 功能 |
|------|------|
| Tab | 切换标签页 |
| ↑/k | 向上滚动 |
| ↓/j | 向下滚动 |
| b | 返回主界面 |
| s | 保存结果 |
| Esc | 返回主界面 |
| Ctrl+C/q | 退出程序 |

## 测试要点

### 标签页切换测试
- 测试Tab键正常切换
- 测试循环切换逻辑
- 测试边界条件（从最后一个到第一个）
- 验证内容正确更新

### 数据展示测试
- 验证概览信息准确性
- 测试文件列表显示
- 测试目录列表显示
- 验证滚动功能

### 交互响应测试
- 测试按键响应速度
- 验证返回功能
- 测试保存功能（如实现）
- 验证错误处理

### 边界条件测试
- 空结果处理
- 大量数据滚动性能
- 特殊字符显示
- 内存使用优化